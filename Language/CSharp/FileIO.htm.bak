<!DOCTYPE html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<script type="text/javascript" src="../../mylib/js/css.js"></script>
<title>使用文件系统</title>
</head>

<body>
<p id="title">文件系统</p>

<h1>常用类介绍</h1>
<h2>System.IO.Directory</h2>
<p>包含对目录的操作，常用方法如下表所示：</p>
<table style="width:100%" class="memberListTable" cellspacing="2" cellpadding="5">
            <col width="10%" />
            <col width="30%" />
            <col width="60%" />
            <tr>
              <th align="left" style="border-left-style: none; border-right-style: none;">
                名称
              </th>
              <th align="left" style="border-left-style: none;">
                说明
              </th>
            </tr>
            <tr valign="top">
              <td>
                CreateDirectory
              </td>
              <td>
                已重载。
													创建指定路径中的所有目录。
												</td>
            </tr>
            <tr valign="top">
              <td>
                Delete
              </td>
              <td>
                已重载。
													删除指定的目录。
												</td>
            </tr>
            <tr valign="top">
              <td>
                Exists
              </td>
              <td>
												确定给定路径是否引用磁盘上的现有目录。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetAccessControl
              </td>
              <td>
                已重载。
													返回某个目录的 Windows 访问控制列表 (ACL)。
												</td>
            </tr>
            <tr valign="top">
              <td>
                GetCreationTime
              </td>
              <td>
												获取目录的创建日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetCreationTimeUtc
              </td>
              <td>
												获取目录创建的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetCurrentDirectory
              </td>
              <td>
												获取应用程序的当前工作目录。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetDirectories
              </td>
              <td>
                已重载。
													获取指定目录中子目录的名称。
可使用通配符嵌套查询												</td>
            </tr>
            <tr valign="top">
              <td>
                GetDirectoryRoot
              </td>
              <td>
												返回指定路径的卷信息、根信息或两者同时返回。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetFiles
              </td>
              <td>
                已重载。
													返回指定目录中的文件的名称。
可使用通配符嵌套查询												</td>
            </tr>
            <tr valign="top">
              <td>
                GetFileSystemEntries
              </td>
              <td>
                已重载。
													返回指定目录中所有文件和子目录的名称。
												</td>
            </tr>
            <tr valign="top">
              <td>
                GetLastAccessTime
              </td>
              <td>
												返回上次访问指定文件或目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetLastAccessTimeUtc
              </td>
              <td>
												返回上次访问指定文件或目录的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetLastWriteTime
              </td>
              <td>
												返回上次写入指定文件或目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetLastWriteTimeUtc
              </td>
              <td>
												返回上次写入指定文件或目录的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetLogicalDrives
              </td>
              <td>
												检索此计算机上格式为“&lt;驱动器号&gt;:\”的逻辑驱动器的名称。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetParent
              </td>
              <td>
												检索指定路径的父目录，包括绝对路径和相对路径。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Move
              </td>
              <td>
												将文件或目录及其内容移到新位置。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetAccessControl
              </td>
              <td>
												将 <MSHelp:link keywords="T:System.Security.AccessControl.DirectorySecurity" TABINDEX="0">DirectorySecurity</MSHelp:link> 对象描述的访问控制列表 (ACL) 项应用于指定的目录。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetCreationTime
              </td>
              <td>
												为指定的文件或目录设置创建日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetCreationTimeUtc
              </td>
              <td>
												设置指定文件或目录的创建日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                SetCurrentDirectory
              </td>
              <td>
												将应用程序的当前工作目录设置为指定的目录。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastAccessTime
              </td>
              <td>
												设置上次访问指定文件或目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastAccessTimeUtc
              </td>
              <td>
												设置上次访问指定文件或目录的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastWriteTime
              </td>
              <td>
												设置上次写入目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastWriteTimeUtc
              </td>
              <td>
												设置上次写入某个目录的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
          </table>
<h2>System.IO.File</h2>
<p>包含对文件的一些操作，常用方法（均为静态方法）如下表所示： </p>
<table style="width:100%" class="memberListTable" cellspacing="2" cellpadding="5">
            <col width="10%" />
            <col width="30%" />
            <col width="60%" />
            <tr>
              <th align="left" style="border-left-style: none; border-right-style: none;">
                名称
              </th>
              <th align="left" style="border-left-style: none;">
                说明
              </th>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                AppendAllText
              </td>
              <td>
                已重载。
													将指定的字符串追加到文件中，如果文件还不存在则创建该文件。
												</td>
            </tr>
            <tr valign="top">
              <td>
                AppendText
              </td>
              <td>
												创建一个 StreamWriter，它将 UTF-8 编码文本追加到现有文件。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Copy
              </td>
              <td>
                已重载。
													将现有文件复制到新文件。
												</td>
            </tr>
            <tr valign="top">
              <td>
                Create
              </td>
              <td>
                已重载。
													在指定路径中创建文件。
												</td>
            </tr>
            <tr valign="top">
              <td>
                CreateText
              </td>
              <td>
												创建或打开一个文件用于写入 UTF-8 编码的文本。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                Decrypt
              </td>
              <td>
												解密由当前帐户使用 Encrypt 方法加密的文件。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Delete
              </td>
              <td>
												删除指定的文件。如果指定的文件不存在，则不引发异常。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                Encrypt
              </td>
              <td>
												将某个文件加密，使得只有加密该文件的帐户才能将其解密。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Exists
              </td>
              <td>
												确定指定的文件是否存在。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetAccessControl
              </td>
              <td>
                已重载。
													获取一个 <MSHelp:link keywords="T:System.Security.AccessControl.FileSecurity" TABINDEX="0">FileSecurity</MSHelp:link> 对象，它封装指定文件的访问控制列表 (ACL) 条目。
												</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetAttributes
              </td>
              <td>
												获取在此路径上的文件的 FileAttributes。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetCreationTime
              </td>
              <td>
												返回指定文件或目录的创建日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetCreationTimeUtc
              </td>
              <td>
												返回指定的文件或目录的创建日期及时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetLastAccessTime
              </td>
              <td>
												返回上次访问指定文件或目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetLastAccessTimeUtc
              </td>
              <td>
												返回上次访问指定的文件或目录的日期及时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetLastWriteTime
              </td>
              <td>
												返回上次写入指定文件或目录的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetLastWriteTimeUtc
              </td>
              <td>
												返回上次写入指定的文件或目录的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Move
              </td>
              <td>
												将指定文件移到新位置，并提供指定新文件名的选项。
											</td>
            </tr>
            <tr valign="top">
              <td>
                Open
              </td>
              <td>
                已重载。
													打开指定路径上的 FileStream。
												</td>
            </tr>
            <tr valign="top">
              <td>
                OpenRead
              </td>
              <td>
												打开现有文件以进行读取。
											</td>
            </tr>
            <tr valign="top">
              <td>
                OpenText
              </td>
              <td>
												打开现有 UTF-8 编码文本文件以进行读取。
											</td>
            </tr>
            <tr valign="top">
              <td>
                OpenWrite
              </td>
              <td>
												打开现有文件以进行写入。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                ReadAllBytes
              </td>
              <td>
												打开一个文件，将文件的内容读入一个字符串，然后关闭该文件。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                ReadAllLines
              </td>
              <td>
                已重载。
													打开一个文本文件，将文件的所有行都读入一个字符串数组，然后关闭该文件。
												</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                ReadAllText
              </td>
              <td>
                已重载。
													打开一个文本文件，将文件的所有行读入一个字符串，然后关闭该文件。
												</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                Replace
              </td>
              <td>
                已重载。
													使用其他文件的内容替换指定文件的内容，这一过程将删除原始文件，并创建被替换文件的备份。
												</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetAccessControl
              </td>
              <td>
												对指定的文件应用由 FileSecurity 对象描述的访问控制列表 (ACL) 项。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetAttributes
              </td>
              <td>
												设置指定路径上文件的指定的 FileAttributes。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetCreationTime
              </td>
              <td>
												设置创建该文件的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetCreationTimeUtc
              </td>
              <td>
												设置文件创建的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastAccessTime
              </td>
              <td>
												设置上次访问指定文件的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastAccessTimeUtc
              </td>
              <td>
												设置上次访问指定的文件的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastWriteTime
              </td>
              <td>
												设置上次写入指定文件的日期和时间。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                SetLastWriteTimeUtc
              </td>
              <td>
												设置上次写入指定的文件的日期和时间，其格式为协调通用时间 (UTC)。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                WriteAllBytes
              </td>
              <td>
												创建一个新文件，在其中写入指定的字节数组，然后关闭该文件。如果目标文件已存在，则改写该文件。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                WriteAllLines
              </td>
              <td>
                已重载。
													创建一个新文件，在其中写入指定的字符串，然后关闭文件。如果目标文件已存在，则改写该文件。
												</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                WriteAllText
              </td>
              <td>
                已重载。
													创建一个新文件，在文件中写入内容，然后关闭文件。如果目标文件已存在，则改写该文件。
												</td>
            </tr>
          </table>
<h2>System.IO.Path</h2>
<p>对文件路径提供一些支持方法（均为静态方法），常用的如下表所示：</p>
<table style="width:90%" >
  <tr>
  	<th width="30%">方法</th>
    <th width="70%">说明</th>
  </tr>
  <tr>
              <td>ChangeExtension </td>
			  <td>更改路径字符串的扩展名。 </td>
            </tr>
            <tr valign="top">
              <td>
                Combine
              </td>
              <td>
											合并两个路径字符串。 该函数有个好处是自动调整在两个字符串间的“\”字符，例如，对于路径&quot;C:&quot;和&quot;1.txt&quot;，无论第一个路径字符串是&quot;C:&quot;还是&quot;C:\&quot;，均可得到正确的合并结果&quot;C:\1.txt&quot;。</td>
            </tr>
            <tr valign="top" name="inheritedMember">
              <td>
                <MSHelp:link keywords="Overload:System.Object.Equals" tabindex="0">Equals</MSHelp:link></td>
              <td>
                已重载。
													确定两个 <MSHelp:link keywords="T:System.Object" TABINDEX="0">Object</MSHelp:link> 实例是否相等。
												（从 <MSHelp:link keywords="T:System.Object" tabindex="0" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">Object</MSHelp:link> 继承。）</td>
            </tr>
            <tr valign="top">
              <td>
                GetDirectoryName
              </td>
              <td>
												返回指定路径字符串的目录信息。
例如，对路径“c:\aa\a.txt”，返回“c:\aa”</td>
            </tr>
            <tr valign="top">
              <td>
                GetExtension
              </td>
              <td>
												返回指定的路径字符串的扩展名。
例如，对路径“c:\aa\a.txt”，返回“.txt”											</td>
            </tr>
            <tr valign="top">
              <td>
                GetFileName
              </td>
              <td>
												返回指定路径字符串的文件名和扩展名。例如，对路径“c:\aa\a.txt”，返回“aa.txt”												</td>
            </tr>
            <tr valign="top">
              <td>
                GetFileNameWithoutExtension
              </td>
              <td>
												返回不具有扩展名的指定路径字符串的文件名。
例如，对路径“c:\aa\a.txt”，返回“aa”												</td>
            </tr>
            <tr valign="top">
              <td>
                GetFullPath
              </td>
              <td>
												返回指定路径字符串的绝对路径。
											</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetInvalidFileNameChars
              </td>
              <td>
												获取包含不允许在文件名中使用的字符的数组。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetInvalidPathChars
              </td>
              <td>
												获取包含不允许在路径名中使用的字符的数组。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetPathRoot
              </td>
              <td>
												获取指定路径的根目录信息。
例如，对路径“c:\aa\a.txt”，返回“c:&quot;</td>
            </tr>
            <tr valign="top" notSupportedOn="netcf">
              <td>
                GetRandomFileName
              </td>
              <td>
												返回随机文件夹名或文件名。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetTempFileName
              </td>
              <td>
												创建磁盘上唯一命名的零字节的临时文件并返回该文件的完整路径。
											</td>
            </tr>
            <tr valign="top">
              <td>
                GetTempPath
              </td>
              <td>
												返回当前系统的临时文件夹的路径。
											</td>
            </tr>
            <tr valign="top">
              <td>
                HasExtension
              </td>
              <td>
												确定路径是否包括文件扩展名。
											</td>
            </tr>
            <tr valign="top">
              <td>
                IsPathRooted
              </td>
              <td>
												获取一个值，该值指示指定的路径字符串是包含绝对路径信息还是包含相对路径信息。
											</td>
            </tr>
</table>
<h1>操作文本文件</h1>

<h2>创建文件并进行读写</h2>
<p>对于UTF-8编码方式的文本文件，可用 File.CreateText() 方法创建写入流，用 file.OpenText() 方法创建读取流。使用 StreamWriter.WriteLine() 方法写入行，用 StreamReader.ReadLine() 方法读取行。 </p>
<pre class="code" data-type="csharp">using System;
using System.IO;

class Test 
{
    public static void Main() 
    {
        string path = @"c:\temp\MyTest.txt";
        if (!File.Exists(path)) 
        {
            // Create a file to write to.
            using (StreamWriter sw = File.CreateText(path)) 
            {
                sw.WriteLine("Hello");
                sw.WriteLine("And");
                sw.WriteLine("Welcome");
            }    
        }

        // Open the file to read from.
        using (StreamReader sr = File.OpenText(path)) 
        {
            string s = "";
            while ((s = sr.ReadLine()) != null) 
            {
                Console.WriteLine(s);
            }
        }
    }
}</pre>
<p>对于任意编码方式的文件，创建 StreamWriter 和 StreamReader 的方法如下：</p>
<pre class="code" data-type="csharp">StreamWriter sw = new StreamWriter(fileName, false, System.Text.Encoding.Default, 1000);</pre>
<p>参数分别为：文件全路径、对于已存在的文件是重写（false）还是添加（true）、编码方式、缓冲区大小</p>
<h1>获取文件信息 </h1>
<p>使用System.IO.File可以得到文件的创建时间、最后修改时间等，但还有一些文件的信息是不能直接从该方法得到的，本节介绍如何获取Windows系统下的其它文件信息。</p>
<h2>文件大小</h2>
<pre class="code" data-type="csharp">FileStream fs = File.OpenRead(file);
return fs.Length;</pre>
<h2>文件描述信息</h2>
<p>在使用Windows打开文件夹时，使用“详细”视图，对于后缀为“txt”的文件，会看到描述信息为“文本文档”，这个信息可通过如下方法获取：</p>
<ol>
  <li>在注册表中查找项HKEY_CLASSES_ROOT\.txt，得到其默认值“txtfile”</li>
  <li>在注册表中查找项HKEY_CLASSES_ROOT\txtfile，得到其默认值“文本文档”</li>
</ol>
<p>示例代码如下所示：</p>
<pre class="code" data-type="csharp">private string GetFileDescription(string FileExt)
{
    string file_ext = FileExt.ToLower();
    if (file_ext[0] != '.')
        file_ext = &quot;.&quot; + file_ext;

    RegistryKey rk1 = Registry.ClassesRoot.OpenSubKey(file_ext);
    if (rk1 == null)
    {
        return &quot;&quot;;
    }

    string rk1_value = Convert.ToString(rk1.GetValue(&quot;&quot;));
    if (rk1_value == string.Empty)
    {
        return &quot;&quot;;
    }

    RegistryKey rk2 = Registry.ClassesRoot.OpenSubKey(rk1_value);
    if (rk2 == null)
    {
        return &quot;&quot;;
    }

    string file_desc = Convert.ToString(rk2.GetValue(&quot;&quot;));
    return file_desc;
}</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>

</body>
</html>
