<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <script type="text/javascript" src="../../mylib/js/css.js"></script>
    <title>Java Note</title>
</head>

<body>
    <p id="title">MyBatis 基础配置</p>
	<h1>insert</h1>
	<p>关键在于主键的生成及获取，如果是对于自增型的，需要在插入后才知道新生成的主键，一般数据库都提供最后生成的数值，以 SQLite 为例，如下所示：</p>
	<pre class="code" data-type="xml">&lt;insert id="insertPoem" parameterType="com.poem.lld.model.Poem"&gt;
    &lt;selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer"&gt;
        select last_insert_rowid() from poem limit 1
    &lt;/selectKey&gt;
    insert into poem (title, author, content, album, `type`, url, public_degree, dynasty)
    values(#{title}, #{author}, #{content}, #{album}, #{type}, #{url}, #{publicDegree}, #{dynasty})
&lt;/insert&gt;</pre>
	<p>如果主键是由自己成成，那使用如下的配置</p>
	<pre class="code" data-type="xml">&lt;selectKey keyProperty="id" order="BEFORE" resultType="java.lang.String"&gt;
    select uuid()
&lt;/selectKey&gt;</pre>
	<p>Java 代码如下</p>
	<pre class="code" data-type="java">protected int insert(String sqlMapId, Object newObj) {
	if (newObj != null) {
		logger.debug("[" + sqlMapId + "] new object: " + newObj.toString());
	} else {
		throw new IllegalArgumentException("Argument is null!");
	}

	int updatedCount = sqlSession.insert(sqlMapId, newObj);
	logger.debug("updated count: " + updatedCount);
	sqlSession.commit();

	return updatedCount;
}
</pre>
	<h1>update</h1>
	<p>XML 配置如下：</p>
	<pre class="code" data-type="xml">&lt;update id="updatePoem" parameterType="com.poem.lld.model.Poem"&gt;
    update poem
    set title = #{title}, author = #{author}, content = #{content}, album = #{album},
        `type` = #{type}, url = #{url}, public_degree = #{publicDegree}, dynasty = #{dynasty} 
    where id=#{id}
&lt;/update&gt;</pre>
	<p>Java 代码如下：</p>
	<pre class="code" data-type="java">protected int update(String sqlMapId, Object updatedObj) {
	if (updatedObj != null) {
		logger.debug("[" + sqlMapId + "] new object: " + updatedObj.toString());
	} else {
		throw new IllegalArgumentException("Argument is null!");
	}

	int updatedCount = sqlSession.update(sqlMapId, updatedObj);
	logger.debug("updated count: " + updatedCount);
	sqlSession.commit();

	return updatedCount;
}
</pre>
	<h1>delete</h1>
	<p>XML 配置如下：</p>
	<pre class="code" data-type="xml">&lt;delete id="deletePoem" parameterType="java.lang.Integer"&gt;
    delete from poem where id=#{id}
&lt;/delete&gt;</pre>
	<p>Java 代码如下：</p>
	<pre class="code" data-type="java">protected int deleteById(String sqlMapId, int id) {
	logger.debug("[" + sqlMapId + "] delete by id: " + id);
	int deleteCount = sqlSession.delete(sqlMapId, id);
	sqlSession.commit();
	return deleteCount;
}
</pre>

</body>
</html>
